---
layout: default
title: Configuration - 
---


<div class="grid_10 prefix_1">
	<div class="subheader">
		ProcessWanker Configuration Format
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The configuration file used by ProcessWanker is a Ruby script. The clauses are implemented as Ruby
			blocks. The root configuration clause is of the form:</p>
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
ProcessWanker::config {
	
	# daemon configuration block
	daemon {
		...
	}

	# client configuration block
	client {
		...
	}

	# optional common auth block
	<i>auth {
		...
	}</i>
	
}		
</pre>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The <code>daemon</code> block contains configuration relevant to ProcessWanker when running as a
			daemon, including the set of processes to be launched and monitored.
		</p>
		<p>The <code>client</code> block is used when ProcessWanker is run as a client from the command-line.
			It contains (among other things) a list of clusters and machines to connect to.
		</p>
		<p>The <code>auth</code> block can appear in a number of different configuration sections. It describes
			the SSL certificates, and IP/name filters to use when authenticating connections between clients and
			daemons. <code>auth</code> blocks can appear in a number of different places within the configuration -
			a more deeply-nested auth block will override the settings in a less deeply-nested block. When present
			here, in the root configuration block, it will act as the default for both clients and daemons. The
			contents of the <code>auth</code> block will be described in more detail later.
		</p>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Daemon block
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The daemon block is of the form:
		</p>
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
daemon {

	listen_hostname    "0.0.0.0"
	listen_port        45231
	log_file           "/var/log/pw.log"

	<i>auth {
		...
	}</i>
	
	<i>smtp {
		...
	}</i>
	
	hook("<i>hook-name</i>") {
		...
	}
	
	services(<i>"group-name"</i>) {
		...
	}
	
	services(<i>"another-group-name"</i>) {
		...
	}
	
}		
</pre>
</div>

<div class="grid_10 prefix_1">
	<div>
		<ul>
			<li><code>listen_hostname</code> (default "127.0.0.1")<p>
				The interface to bind to when listening for incoming client connections. <i>(Note that if a suitable
				<code>auth</code> block is not provided, and the built-in default is used, ProcessWanker will refuse
				to listen on anything other than 127.0.0.1 for security reasons.)</i>
			</p></li>
			<li><code>listen_port</code> (default 45231)<p>
				The TCP port to listen on.
			</p></li>
			<li><code>log_file</code> (default /dev/null)<p>
				The file to log ProcessWanker output to.
			</p></li>
		</ul>
		<p>
			<code>hook</code> blocks allow user-defined handlers to be executed when certain events occur.
			They will be described in more detail later.
		</p>
		<p>
			<code>smtp</code> blocks specify email parameters used for sending notifications. They will be described
			in more detail later.
		</p>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Services block(s)
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The services blocks define a list of services that are logically grouped together, generally by
			association with a specific application. This grouping allows clients to control an entire set of
			services <i>en masse</i>, but is entirely optional. If <code>"group-name"</code> is omitted,
			services will be grouped under the a group named <code>"default"</code>.
		</p>
		<p>Each service within the group is given a unique name, and defined using one of the built-in
			service classes. Each service class corresponds to a different method that ProcessWanker can use
			to start/stop and monitor services. The parameters within the service block depend on the 
			service class used.
		</p>
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
services("group_name") {
	
	process_service("rails") {
		...
	}
	
	pid_service("apache2") {
		...
	}
	
	upstart_service("mysql") {
		...
	}
	
}		
</pre>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Client block
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
client {

	<i>auth {
		...
	}</i>
	
	clusters {
		...
	}
	
}
</pre>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The <code>client</code> block contains the half of the configuration used when running ProcessWanker
			from the command-line. It details a known list of remote hosts running ProcessWanker daemons that we can
			connect to and control.
		</p>
		<p>Remote hosts are logically grouped into <i>"clusters"</i>. Typically a cluster would define a single
			deployed environment, possibly containing multiple machines. We might, for instance, have a <i>staging</i>
			cluster, and a <i>production</i> cluster - or perhaps different clusters for different deployed
			applications.
		</p>
	</div>
</div>


<div class="grid_10 prefix_1">
	<div class="subheader">
		Clusters block
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
clusters {

	<i>auth {
		...
	}</i>
	
	cluster(<i>"cluster-name"</i>) {
		...
	}
	
}
</pre>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The <code>clusters</code> block is a simple container for one or more named clusters.
		</p>
	</div>
</div>


<div class="grid_10 prefix_1">
	<div class="subheader">
		Cluster block
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
cluster("cluster-name") {

	<i>auth {
		...
	}</i>
	
	host(<i>"host-name"</i>) {
		...
	}
	
	host(<i>"another-host-name"</i>) {
		...
	}
	
}
</pre>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The <code>cluster</code> block is a container for a logically grouped set of remote hosts.
		</p>
	</div>
</div>


<div class="grid_10 prefix_1">
	<div class="subheader">
		Host block
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
host("friendly-host-name") {

	<i>auth {
		...
	}</i>
	
	hostname				"db.mynetwork.com"
	port					45231
	tags					"db","foo"
	
}
</pre>
</div>


<div class="grid_10 prefix_1">
	<div class="subheader">
		Auth block(s)
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
auth {
	ca_cert           "/etc/pw/certs/ca.crt"
	my_cert           "/etc/pw/certs/my.crt"
	my_key            "/etc/pw/certs/my.key"
	
	accept_peers      "fred","bob","daemons"
	reject_peers      "alice"
	accept_ip         "192.168.0.0/24"
	accept_ip         "99.123.57.0/24"
	reject_ip         "10.0.0.0/8"
}
</pre>
</div>



<div class="grid_10 prefix_1">
	<div>
		<p>The following parameters are required:</p>
		<ul>
			<li><code>ca_cert</code><p>
				Location of the Certificate Authority's certificate
			</p></li>
			<li><code>my_cert</code><p>
				Location of the certificate for our client/daemon to present to other clients/daemons
			</p></li>
			<li><code>my_key</code><p>
				Location of the private key for our client/daemon to use
			</p></li>
		</ul>
		<p>The following parameters are optional, and mostly make sense only on the daemon side:</p>
		<ul>
			<li><code>accept_peers</code><p>
				If any <code>accept_peers</code> entries are present, then a connecting client <i>must</i>
				have an identity appearing in the list in order for their requests to be processed. If no
				such entries are present, then anybody can connect (except for <code>reject_peers</code>!)
			</p></li>
			<li><code>reject_peers</code><p>
				If a connecting client's identity appears in the <code>reject_peers</code> list, their
				connections will be rejected. This is useful for revoking access without re-generating new
				certificates.
			</p></li>
			<li><code>accept_ip</code><p>
				If any <code>accept_ip</code> entries are present, then a connecting client <i>must</i>
				be connecting from an IP address in the list in order for the connection to be accepted. IP
				addresses are specified in the typical <code>address</code>/<code>mask-bits</code> format.
			</p></li>
			<li><code>reject_ip</code><p>
				Connection attempts originating from IP addresses appearing in <code>reject_ip</code> entries
				will be rejected.
			</p></li>
		</ul>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		SMTP block
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The SMTP block is used to define email parameters for notifications. It's used only within the
			<code>daemon</code> block, and can also appear inside <code>services</code> and <code>service</code>
			blocks, where it will override any settings defined in a less nested level.</p>
	</div>
</div>

<div class="grid_10 prefix_1">
<pre class="prettyprint">
smtp {
	server         "smtp.gmail.com"
	port           587
	secure         "starttls"
	to_addrs       "asdasdasd@gmail.com","joe-admin@blahblah.com"
	from_addr      "asdasdasd@gmail.com"
	userid         "asdasdasd@gmail.com"
	password       "asdasdasd"
	auth_method    "plain"
}
</pre>
</div>



<div class="grid_10 prefix_1">
	<div>
		<p>The following parameters are required:</p>
		<ul>
			<li><code>server</code><p>
				Hostname of the SMTP server to connect to
			</p></li>
			<li><code>port</code><p>
				TCP port on the SMTP server to connect
			</p></li>
			<li><code>to_addrs</code><p>
				Email address(es) to send notifications to
			</p></li>
			<li><code>from_addr</code><p>
				Email address that should be used as the source of notification emails
			</p></li>
		</ul>
		<p>The following parameters can optionally be used to provide authentication and/or encryption when
			communicating with the SMTP server.
		</p>
		<ul>
			<li><code>auth_method</code><p>
				<code>"plain"</code>, <code>"login"</code> or <code>"cram_md5"</code>.
			</p></li>
			<li><code>secure</code><p>
				<code>"tls"</code>, <code>"ssl"</code> (these are the same) or <code>"starttls"</code>.
			</p></li>
			<li><code>userid</code><p>
				User ID to use when authenticating with SMTP server.
			</p></li>
			<li><code>password</code><p>
				Password to use when authenticating with SMTP server.
			</p></li>
		</ul>
	</div>
</div>
