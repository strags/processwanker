---
layout: default
title: Command Line - 
---


<div class="grid_10 prefix_1">
	<div class="subheader">
		ProcessWanker Command Line Reference
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>All ProcessWanker options can be viewed with the <code>--help</code> option:</p>
	</div>
</div>

<div class="grid_10 prefix_1">
<pre style="background: #000040; -moz-border-radius: 8px; padding: 10px;
-webkit-border-radius: 8px;
-o-border-radius: 8px;
-ms-border-radius: 8px;
-khtml-border-radius: 8px;
border-radius: 8px;
color: #ffffff;
font-size: 12px;
">
<b>$ pw --help</b>

Usage: pw [options]
        --help                       Display this screen
    -l, --list [SERVICE_SPEC]        Show the status of the given service(s)
    -s, --start SERVICE_SPEC         Start the given service(s)
    -k, --kill SERVICE_SPEC          Stop the given service(s)
    -i, --ignore SERVICE_SPEC        Ignore the given service(s)
        --stop SERVICE_SPEC          Stop the given service(s)
    -r, --restart SERVICE_SPEC       Restart the given service(s)
    -w, --wait SECS                  Wait SECS seconds for service(s) to reach requested state, default (60)
        --sequential [DELAY_SECS]    Execute all operations sequentially, with optional delay between them
        --reload                     Reload configuration
        --terminate                  Terminate daemon
    -c, --cluster NAME               Select a cluster to control
    -h, --host HOST                  Select a single host to control
    -g, --config FILE                Specify configuration file to use (/etc/pw/pw.cfg)
        --list-clusters              Display a list of known clusters and hosts
    -d, --daemon                     Run in the background as a server
    -f, --foreground                 Don't detach - stay in the foreground (useful only with -d option)
        --notboot                    Don't start all local services automatically (useful only with the -d option)
        --generate-ca                Generate CA cert/key (requires --output-prefix)
        --output-prefix PATH         Specify output file prefix for .crt and .key
        --ca-prefix PATH             Specify input file location prefix for the CA certificate and key
        --require-passphrase         Use a passphrase to encrypt any generated private keys
        --generate-user NAME         Generate client cert/key - requires (--ca-prefix and --output-prefix)
        --debug                      Debug hook
        --log                        Log file (for pw output only)
        --verbose                    Debugging enabled

  SERVICE_SPEC can be a 'all', a name, a regular expression, or a tag - eg. tag:db
  It can also be a comma-separated list of all of the above. Prefixing a string/regex/tag with
  a tilde (~) has the meaning 'except'.

</pre>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Specifying which config file to use
	</div>
</div>

<div class="grid_10 prefix_1">
	<ul>
		<li><code>-g, --config FILE</code>
			<p>
				This option will override any other config file path setting.
			</p>
	</ul>
	<p>
		The configuration file location will default to <code>/etc/pw/pw.cfg</code>. If the <code>PW_CFG</code>
		environment variable is set, the corresponding location will be used instead. The <code>--config</code> option
		will override both of these.
	</p>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Observing and controlling services
	</div>
</div>

<div class="grid_10 prefix_1">
	<ul>
		<li><code>-l, --list [SERVICE_SPEC]</code>
			<p>
				Show the status of the given service(s). When no SERVICE_SPEC is provided, "all" is assumed.
			</p>
		<li><code>-s, --start SERVICE_SPEC</code>
			<p>
				Set the given services' "desired state" to be "up". ProcessWanker will attempt to start the given
				services, subject to the retry attempts and timeouts defined in the daemon configuration.
			</p>
		<li><code>-k, --kill, --stop SERVICE_SPEC</code>
			<p>
				Set the given services' "desired state" to be "down". ProcessWanker will attempt to stop the given
				services.
			</p>
		<li><code>-r, --restart SERVICE_SPEC</code>
			<p>
				Attempt to stop the given services (if they are currently running), and then start them again.
			</p>
		<li><code>-i, --ignore SERVICE_SPEC</code>
			<p>
				Sets the given services to be "ignored". This means that ProcessWanker will continue to monitor their
				state, but will not attempt to start or stop them. Issuing a subsequent <code>start</code>,
				<code>stop</code>, or <code>restart</code> command will cancel the ignore state. This is useful if
				you wish to debug a service by running it manually from the command line, without ProcessWanker's
				interference.
			</p>
	</ul>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		The SERVICE_SPEC
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>The <i>SERVICE_SPEC</i> parameter is used to indicate which processes we wish to
			list or control. This parameter is fairly flexible, and permits matching services based on their name,
			group-name, tags, or any regular-expression of name/group-name.</p>
		<p>Using a daemon configuration like the following example:</p>
		<pre class="prettyprint">
ProcessWanker::config {
	daemon {
		services("web") {
			pid_service("apache") {
				...
			}
			process_service("rails") {
				...
				tags "foo","bar"
			}
			upstart_service("mysql") {
				...
			}
		}
	}
}
		</pre>
		<p>The simplest possible SERVICE_SPEC is just the name of a service as it appears in the configuration:</p>
		<pre class="prettyprint">
$ pw --stop apache
==[localhost] send :stop to apache

[localhost]
    name                           state                          want-state           tags
    apache                         down                           down                 
		</pre>
		<p><code>"all"</code> will match every service:</p>
		<pre class="prettyprint">
$ pw --start all
		</pre>
		<p>We can also specify a comma-separated list of services:</p>
		<pre class="prettyprint">
$ pw --start apache,rails
		</pre>
		<p>... or the name of a group of services:</p>
		<pre class="prettyprint">
$ pw --start web
		</pre>
		<p>We can also specify any process with a specific tag:</p>
		<pre class="prettyprint">
$ pw --restart tag:foo
		</pre>
		<p>Getting more complex, we can specify everything <i>except</i> a pattern. Note that we may require
			double-quotes to prevent our shell from interfering with the command.</p>
		<pre class="prettyprint">
$ pw --list "~mysql"
		</pre>
		<p>We can chain these together. The following command will restart every service in the "web" group, except
			apache:</p>
		<pre class="prettyprint">
$ pw --restart "web,~apache"
		</pre>
		<p>Finally, we can use regular expressions - the following example will restart service whose name or group-name begins with <b>a</b>.</p>
		<pre class="prettyprint">
$ pw --restart "/^a/"
		</pre>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Modifiers to the list/control commands
	</div>
</div>
<div class="grid_10 prefix_1">
	<div>
		<ul>
			<li><code>--sequential [DELAY_SECS]</code>
				<p>
					Rather than concurrently attempt to start/stop/restart all matching services at the same time,
					perform the actions one-at-a-time. If a <code>DELAY_SECS</code> parameter is provided, then
					pause for the corresponding number of seconds between each service. (Note that if we are
					performing these operations on several hosts, then each host will also be processed one-at-a-time).
					This is useful for performing a "rolling-restart" on web services.
				</p>
			<li><code>-w, --wait SECS</code>
				<p>
					When a start/stop/restart command is issued, by default ProcessWanker will wait up to 60 seconds
					for the service to attain its intended state. You can adjust this timeout using the <code>--wait</code>
					parameter.
				</p>
			<li><code>-c, --cluster NAME</code>
				<p>
					If we have a configuration with multiple clusters of hosts, the <code>--cluster</code> command
					enables us to specify which group of hosts the intended action is for. Any start/stop/restart/list
					commands will be executed on all hosts in the cluster. If no cluster is specified, the cluster
					named <code>"default"</code> will be used. If no "default" cluster is defined in the daemon
					configuration file, a default one is created that contains <code>localhost</code> only.
				</p>
			<li><code>-h, --host HOST_SPEC</code>
				<p>
					Allows us to control which hosts in the selected cluster are to be affected. The HOST_SPEC is
					treated in the same manner as the SERVICE_SPEC - it can be a hostname, a list of hostnames, a 
					regular-expression, a tag specification, etc... By default, <code>"all"</code> is used, which
					applies to all hosts in the selected cluster.
				</p>
		</ul>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Administrative commands
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<ul>
			<li><code>--terminate</code>
				<p>
					Send the daemon a command instructing it to exit.
				</p>
			<li><code>--reload</code>
				<p>
					Instruct the daemon to reload its configuration. (Currently only service definitions are reloaded).
				</p>
			<li><code>--list-clusters</code>
				<p>
					Display a list of known clusters, and the hosts contained in each.
				</p>
		</ul>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Networking/Certificate options
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>
			See the Networking section for more information regarding these commands.
		</p>
		<ul>
			<li><code>--generate-ca</code>
				<p>
					Generate a Certificate Authority certificate and key. Requires the <code>--output-prefix</code> option. See Networking for more information.
				</p>
			<li><code>--generate-user NAME</code>
				<p>
					Generate a user certificate and key. Requires the <code>--output-prefix</code>, <code>--ca-prefix</code> options. See Networking for more information.
				</p>
			<li><code>--require-passphrase</code>
				<p>
					When generating CA or user certificates/keys will request that you enter a passphrase used to encrypt
					the private key.
				</p>
			<li><code>--ca-prefix</code>
				<p>
					Prefix for the Certificate Authority certificate and key. This is required when generating user certificates/keys.
				</p>
			<li><code>--output-prefix</code>
				<p>
					Prefix for the output certificate and key. This is required when generating CA or user certificates/keys.
				</p>
		</ul>
	</div>
</div>

<div class="grid_10 prefix_1">
	<div class="subheader">
		Daemon options
	</div>
</div>

<div class="grid_10 prefix_1">
	<div>
		<p>
			These commands are used when launching the ProcessWanker daemon.
		</p>
		<ul>
			<li><code>-d, --daemon</code>
				<p>
					Specify that we are starting the daemon.
				</p>
			<li><code>-f, --foreground</code>
				<p>
					Do not detach the daemon - remain in the foreground. This is useful for debugging issues with 
					configuration or service launching.
				</p>
			<li><code>--notboot</code>
				<p>
					By default, the daemon assumes it is being launched at boot time, and consequently should launch
					all requested services. Passing the <code>--notboot</code> option will cause the daemon to start
					monitoring services, but leave them all in their current state.
				</p>
			<li><code>--log FILE</code>
				<p>
					Specify a file for the daemon to log its output to. This will only have an effect if 
					<code>--foreground</code> is not specified. This will override any setting in the daemon config.
				</p>
			<li><code>--output-prefix</code>
				<p>
					Prefix for the output certificate and key. This is required when generating CA or user certificates/keys.
				</p>
		</ul>
	</div>
</div>
